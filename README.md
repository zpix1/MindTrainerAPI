This README is created only for russian speaking people. If you want to use this api to create a mindtrainer, but you don't speak russian, you could send an email (zpix-dev@list.ru)
# О создании тренажера для beta.mindtrainer.ru
### Полезные материалы для изучения
Для создания тренажера нужно знать несколько языков программирования. Вот некоторые материалы для подготовки. Предложенные ссылки это лишь рекомендации, вы можете выбирать материал как вам хочется.
* HTML
    * Чтобы понимать структуру файлов интерфейса, вам необходимо хотя бы немного знать HTML. http://htmlbook.ru/samhtml/vvedenie-v-html
* JavaScript
    * Начать стоит с изучения основ https://learn.javascript.ru/hello-world, https://learn.javascript.ru/variables и далее по сайту. Не обязательно читать все статьи, так как там есть много ненужного материала, но обязательно изучите структуры данных, циклы, условные операторы, работу с DOM
    * После изучения основ, ознакомьтесь с Canvas, если ваш тренажер предполагает графику. https://habrahabr.ru/post/111308/

P.S. Имейте ввиду, что полностью выучить что-то практически невозможно, но сейчас ответ на почти любой вопрос связанный с программированием можно найти в сети, просто забив его в google. 

### Об API
Обертка использует фреймворк Sinatra, написанный на языке Ruby. Также используется ядро тренажера на языке Python. Если вы собираетесь использовать другой язык программирования, то можете не ставить Python (пропустите шаг 6 при установке API).
#### Установка для Windows
1. Установите [Ruby-2.4](https://rubyinstaller.org/downloads/),  не снимайте галочки при установке, но после установки снимите галочку
2. Скачайте [репозиторий](https://github.com/zpix1/MindTrainerAPI/archive/master.zip) и распакуйте его в какую-нибудь папку (ВАЖНО: папка не должна иметь русские буквы в названии и пути до нее), где вы будете разрабатывать тренажер.
3. Откройте командную строку Windows в папке с репозиторием.
4. Установите bundler командой
    `gem install bundler`
5. Установите sinatra командой
    `bundle install`
6. Установите [Python-3.6](https://www.python.org/downloads/). Не забудьте поставить галочку `Add Python 3.6 to PATH`.

#### Установка для Linux
1. Установите ruby своим пакетным менеджером (`apt-get install ruby` для Debian, Ubuntu)
2. Скачайте [репозиторий](https://github.com/zpix1/MindTrainerAPI/archive/master.zip) и распакуйте его в какую-нибудь папку, где вы будете разрабатывать тренажер.
3. Откройте командную строку в этой папке
4. Установите bundler командой
    `gem install bundler`
5. Установите sinatra командой
    `bundle install`
6. Python 3 обычно уже установлен на всех популярных дистрибутивах Linux

#### Обзор API
Чтобы запустить сервер, запустите файл run.bat для Windows или run.sh для Linux

Вы можете открыть сайт в браузере по адресу
    `http://localhost:4567`

API состоит из:
1. Файлов интерфейса, располагающихся в папке `views`,  а именно check.html.erb, show.html.erb и layout.html.erb. Вам потребуется менять только show и check.
2. Файла сервера, менять его вам не потребуется
3. Конфигурации тренажера `config.json`, там обязательно должны быть заданы значения к ключам `command`,`config` и `config_template`, команда для запуска ядра, конфигурация тренажера и шаблон настроек, форматы которых описаны ниже, соответственно.
### Общее
Новая версия MindTrainer'a поддерживает тренажеры на разных языках программирования
Каждый  тренажер состоит из 3 частей:

1. Ядро - консольная программа, обеспечивающая проверку и генерацию задачи.
2. Интерфейс - визуальная часть тренажера, набор из CSS, JavaScript и HTML, который показывает задачу и предоставляет удобные инструменты для её решения.
3. Ник  и шаблон настроек.
### Техническая часть
#### Ядро
Ядро может быть написано на любом языке программирования, компилятор или интерпретатор которого есть на сервере или который можно туда поставить, но вот список рекомендуемых языков: C, C++, Python, Ruby, PHP, Perl

Ядро должно отвечать консольные вызовы такого типа:

1. `generate '<json config>' '<seed>'`, где `<json config>` это конфигурация в формате JSON (ассоциативный массив вида [название параметра => значение], названия берутся из шаблона настроек), a `<seed>` это целое число, которое необходимо использовать для инициализации генератора случайных чисел в ядре. Ядро должно выдать закодированный в формат JSON ассоциативный массив, имеющий 2 ключа - `question` и `answer`, задача и ответ на нее, если такой необходим для работы `check`, соответственно.
2. `check '<user answer>' '<answer>'`, где `<user answer>` ответ пользователя, `<answer>` - ответ на задачу из `generate`. В ответ программа должна выдать либо "true", либо "false" в зависимости от правильности ответа пользователя.

#### Интерфейс
Интерфейс в MindTrainer'e может быть очень гибким, поэтому к нему не предъявляется особых требований. Главное, должны быть поля для входных данных и для выходных.
Лучше будет видно в примере.

#### Ник и шаблон настроек
У каждого тренажера должен быть свой ник, позволяющий системе однозначно его определять.
Например, у анаграмм - `anagram`, у разрезаний - `razrez`.

Также, тренажер должен иметь шаблон настроек. Это массив, закодированный в формате JSON который дает системе информацию о параметрах тренажера.

Массив состоит из словарей (ассоциативных массивов) на каждый параметр, имеющих следующие ключи:

* `nick` - название параметра (строка из латинских букв, без пробелов (как название переменной)), именно оно пойдет в конфигурацию для `generate`.
* `description` - описание параметра (на русском, нужно для панели настройки тренажера у администратора)
* `type` - строка, содержащая тип параметра. Сейчас поддерживаются только `int` и `int_table` - целое число и таблица целых чисел соотвественно. Для `int` должны быть ключи `min` и `max`, минимальное и максимальное возможное значение параметра, а для `int_table` помимо `min` и `max` должны быть ключи `height` и `width` - высота и ширина таблицы.


### Пример
Напишем тренажер сложения цифр.

Определимся с ником. Пусть будет `digsum`.

Определимся с шаблоном настроек. Будет 1 параметр - максимальное значение цифры. 
```JSON
[
    {
        "nick":"maxval",
        "type":"int",
        "min":0,
        "max":9,
        "description":"Максимальное значение цифры"
    }
]
```

Напишем ядро на языке Python (`task.py` в API)
``` Python
import sys # Для доступа к аргументам командной строки
import json # Для парсинга JSON
from random import randint,seed # Для генерации цифр

mode = sys.argv[1] # Получем режим
if mode == 'generate': # Если надо сгенерировать задачу
    config = json.loads(sys.argv[2]) # Получаем конфигурацию
    s = int(sys.argv[3]) # Получем зерно для генератора случайных чисел
    seed(s) # Используем это зерно
    maxval = config["maxval"]
    a = randint(0, maxval) # Генерируем цифры для сложения
    b = randint(0, maxval)
    question = str(a) + " + " + str(b) + " = ?" # Вопрос
    answer = str(a+b) # Ответ
    print(json.dumps({'question':question,'answer':answer}))
elif mode == 'check': # Если надо проверить
    user_answer = int(sys.argv[2]) # Считываем ответ пользователя и настоящий ответ
    answer = int(sys.argv[3])
    if user_answer == answer: # Если правильно, то пишем true, иначе false
        print('true')
    else:
        print('false')
```
Напишем интерфейс, будет 2 файла - show и check

Тут используется технология erb, знать ее не обязательно, скобочки вида `<%= %>` просто вставляют строку написанную в них в код. (как `<?php ?>` в PHP)

`@task['question']` - ровно то, что выдало ядро в вопросе.

show.html.erb
``` HTML
<form action="/check" accept-charset="UTF-8" method="post">
<font size="20"><%= @task['question'] %></font>
<br>
<input size="10" type="number" class="form-control" id="user_answer" name="user_answer"> 
<input type="submit" name="commit" value="Ответить" class="btn" data-disable-with="Ответить" />
</form>
```

Этот файл покажется только если ответ пользователя неверный

`@task['answer']` - ровно то, что выдало ядро в ответе.

check.html.erb
``` HTML
Вы ошиблись! Правильный ответ: <%= @task['answer'] %>
<a href='/'>Далее</a>
```

Все! Осталось добавить эти файлы в систему, это займет совсем немного времени.